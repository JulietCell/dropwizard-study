# Dropwizard Test Project

ä¸€ä¸ªåŸºäº Dropwizard æ¡†æ¶çš„å¤šæ¨¡å— Java Web åº”ç”¨ç¨‹åºï¼Œé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä½¿ç”¨ HK2 è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚

## ğŸ“‹ ç›®å½•

- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [æ¨¡å—è¯´æ˜](#æ¨¡å—è¯´æ˜)
- [æ¶æ„å›¾](#æ¶æ„å›¾)
- [ä¾èµ–å…³ç³»](#ä¾èµ–å…³ç³»)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [API ç«¯ç‚¹](#api-ç«¯ç‚¹)

## ğŸ›  æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Dropwizard 4.0.0
- **è¯­è¨€**: Java 21
- **ORM**: Hibernate (via Dropwizard Hibernate)
- **ä¾èµ–æ³¨å…¥**: HK2 (GlassFish HK2)
- **æ•°æ®åº“**: MySQL 8.0
- **æ„å»ºå·¥å…·**: Maven
- **å…¶ä»–å·¥å…·**: 
  - Lombok (ä»£ç ç®€åŒ–)
  - Reflections (ç±»æ‰«æ)
  - JUnit 5 (æµ‹è¯•)

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
dw-test-02/
â”œâ”€â”€ dw-model/          # å®ä½“æ¨¡å‹å±‚
â”œâ”€â”€ dw-common/         # é€šç”¨å·¥å…·å±‚
â”œâ”€â”€ dw-dao/            # æ•°æ®è®¿é—®å±‚
â”œâ”€â”€ dw-service/        # ä¸šåŠ¡æœåŠ¡å±‚
â”œâ”€â”€ dw-resource/       # REST èµ„æºå±‚ï¼ˆAPI å±‚ï¼‰
â”œâ”€â”€ dw-bootstrap/      # åº”ç”¨å¯åŠ¨å±‚
â”œâ”€â”€ pom.xml            # çˆ¶ POM
â”œâ”€â”€ run.bat            # Windows å¯åŠ¨è„šæœ¬
â””â”€â”€ run.sh             # Linux/Mac å¯åŠ¨è„šæœ¬
```

## ğŸ— æ¨¡å—è¯´æ˜

### 1. dw-model (å®ä½“æ¨¡å‹å±‚)
- **åŒ…å**: `com.gutou.model.entity`
- **èŒè´£**: å®šä¹‰é¢†åŸŸå®ä½“ç±»ï¼ˆEntityï¼‰
- **ä¾èµ–**: 
  - Jakarta Persistence API (JPA)
  - Lombok
- **ç¤ºä¾‹**: `User.java`

### 2. dw-common (é€šç”¨å·¥å…·å±‚)
- **åŒ…å**: `com.gutou.common`
- **èŒè´£**: å­˜æ”¾é€šç”¨çš„å·¥å…·ç±»å’Œå…¬å…±ä»£ç 
- **çŠ¶æ€**: é¢„ç•™æ¨¡å—ï¼Œç›®å‰ä¸ºç©º
- **ç”¨é€”**: æœªæ¥å¯å­˜æ”¾å·¥å…·ç±»ã€å¸¸é‡ã€å¼‚å¸¸ç±»ç­‰

### 3. dw-dao (æ•°æ®è®¿é—®å±‚)
- **åŒ…å**: `com.gutou.dao`
- **èŒè´£**: æ•°æ®åº“è®¿é—®æ“ä½œï¼ˆData Access Objectï¼‰
- **ä¾èµ–**: 
  - dw-model
  - Dropwizard Hibernate
- **ç‰¹ç‚¹**: ç»§æ‰¿ `AbstractDAO`ï¼Œç”± HK2 è‡ªåŠ¨ç»‘å®š
- **ç¤ºä¾‹**: `UserDAO.java`

### 4. dw-service (ä¸šåŠ¡æœåŠ¡å±‚)
- **åŒ…å**: `com.gutou.service`
- **èŒè´£**: ä¸šåŠ¡é€»è¾‘å¤„ç†
- **ä¾èµ–**: 
  - dw-dao
  - dw-model
  - HK2 API (ç”¨äºä¾èµ–æ³¨å…¥)
- **ç‰¹ç‚¹**: 
  - ä½¿ç”¨ `@Contract` å®šä¹‰æ¥å£
  - ä½¿ç”¨ `@Service` æ ‡æ³¨å®ç°ç±»
  - ç”± HK2 è‡ªåŠ¨æ‰«æå’Œç»‘å®š
- **ç¤ºä¾‹**: 
  - `UserServiceApi.java` (æ¥å£)
  - `UserServiceImpl.java` (å®ç°)

### 5. dw-resource (REST èµ„æºå±‚)
- **åŒ…å**: `com.gutou.resource`
- **èŒè´£**: å®šä¹‰ RESTful API ç«¯ç‚¹
- **ä¾èµ–**: 
  - dw-service (ä¸šåŠ¡é€»è¾‘)
  - dw-model (å®ä½“ç±»ä½œä¸ºè¾“å…¥è¾“å‡º)
  - Dropwizard Core
  - HK2 API
- **ç‰¹ç‚¹**: 
  - ä½¿ç”¨ Jersey `@Path` æ³¨è§£
  - ä½¿ç”¨ `@UnitOfWork` ç®¡ç†äº‹åŠ¡
  - é€šè¿‡ä¾èµ–æ³¨å…¥ä½¿ç”¨ Service å±‚
- **ç¤ºä¾‹**: 
  - `UserResource.java`
  - `ContainerInspectorResource.java`

### 6. dw-bootstrap (åº”ç”¨å¯åŠ¨å±‚)
- **åŒ…å**: `com.gutou.app`
- **èŒè´£**: åº”ç”¨å¯åŠ¨ã€é…ç½®ç®¡ç†å’Œæ¡†æ¶åˆå§‹åŒ–
- **ä¾èµ–**: æ‰€æœ‰å…¶ä»–æ¨¡å—
- **å†…å®¹**:
  - `DwTestApplication.java` - åº”ç”¨ä¸»ç±»
  - `DwTestConfiguration.java` - é…ç½®ç±»
  - æ ¸å¿ƒå·¥å…·ç±»ï¼š
    - `Hk2DaoBinder` - DAO è‡ªåŠ¨ç»‘å®š
    - `Hk2ServiceBinder` - Service è‡ªåŠ¨ç»‘å®š
    - `JerseyResourceRegistrar` - Resource è‡ªåŠ¨æ³¨å†Œ
  - é…ç½®æ–‡ä»¶: `config.yml`
- **ç‰¹ç‚¹**: ä½¿ç”¨ Maven Shade Plugin æ‰“åŒ…æˆå¯æ‰§è¡Œ JAR

## ğŸ¨ æ¶æ„å›¾

### æ¨¡å—ä¾èµ–å…³ç³»å›¾

#### Mermaid æµç¨‹å›¾ (æ”¯æŒ GitHub/GitLab æ¸²æŸ“)

```mermaid
graph TB
    Bootstrap[dw-bootstrap<br/>åº”ç”¨å¯åŠ¨å±‚]
    Resource[dw-resource<br/>REST APIå±‚]
    Service[dw-service<br/>ä¸šåŠ¡é€»è¾‘å±‚]
    DAO[dw-dao<br/>æ•°æ®è®¿é—®å±‚]
    Model[dw-model<br/>å®ä½“æ¨¡å‹å±‚]
    Common[dw-common<br/>é€šç”¨å·¥å…·å±‚]
    
    Bootstrap --> Resource
    Bootstrap --> Service
    Bootstrap --> DAO
    Bootstrap --> Model
    Bootstrap --> Common
    
    Resource --> Service
    Resource --> Model
    
    Service --> DAO
    Service --> Model
    
    DAO --> Model
    
    style Bootstrap fill:#e1f5ff
    style Resource fill:#fff4e1
    style Service fill:#e8f5e9
    style DAO fill:#f3e5f5
    style Model fill:#fce4ec
    style Common fill:#f1f8e9
```

#### ASCII æ–‡æœ¬å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   dw-bootstrap                          â”‚
â”‚              (åº”ç”¨å¯åŠ¨ & é…ç½®ç®¡ç†)                        â”‚
â”‚  - DwTestApplication                                    â”‚
â”‚  - Hk2DaoBinder, Hk2ServiceBinder                      â”‚
â”‚  - JerseyResourceRegistrar                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ ä¾èµ–æ‰€æœ‰æ¨¡å—
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dw-resource   â”‚ â”‚   dw-service          â”‚
â”‚  (REST APIå±‚)   â”‚ â”‚   (ä¸šåŠ¡é€»è¾‘å±‚)         â”‚
â”‚                â”‚ â”‚                       â”‚
â”‚  UserResource  â”‚ â”‚  UserServiceApi       â”‚
â”‚                â”‚ â”‚  TaskMngApi           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚
        â”‚ ä¾èµ– service    â”‚ ä¾èµ– dao
        â”‚ å’Œ model        â”‚ å’Œ model
        â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   dw-service   â”‚ â”‚      dw-dao           â”‚
â”‚   (å·²åŒ…å«)      â”‚ â”‚   (æ•°æ®è®¿é—®å±‚)         â”‚
â”‚                â”‚ â”‚                       â”‚
â”‚                â”‚ â”‚  UserDAO              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ ä¾èµ– model
                         â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚    dw-model      â”‚
                â”‚   (å®ä½“æ¨¡å‹å±‚)    â”‚
                â”‚                  â”‚
                â”‚  User (Entity)   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†å±‚æ¶æ„å›¾

#### Mermaid åºåˆ—å›¾ (è°ƒç”¨æµç¨‹)

```mermaid
sequenceDiagram
    participant Client as Client (HTTP)
    participant Resource as dw-resource<br/>UserResource
    participant Service as dw-service<br/>UserServiceImpl
    participant DAO as dw-dao<br/>UserDAO
    participant DB as Database (MySQL)
    
    Client->>Resource: GET /users/{id}
    Resource->>Service: userService.findById(id)
    Service->>DAO: userDAO.findById(id)
    DAO->>DB: SELECT * FROM users WHERE id=?
    DB-->>DAO: User data
    DAO-->>Service: Optional<User>
    Service-->>Resource: Optional<User>
    Resource-->>Client: JSON Response
```

#### ASCII æ–‡æœ¬å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Client (HTTP)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              dw-resource (REST API å±‚)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  @Path("/users")                               â”‚    â”‚
â”‚  â”‚  UserResource                                  â”‚    â”‚
â”‚  â”‚  - å¤„ç† HTTP è¯·æ±‚                              â”‚    â”‚
â”‚  â”‚  - å‚æ•°éªŒè¯                                    â”‚    â”‚
â”‚  â”‚  - è°ƒç”¨ Service                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ è°ƒç”¨
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              dw-service (ä¸šåŠ¡æœåŠ¡å±‚)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  @Service                                      â”‚    â”‚
â”‚  â”‚  UserServiceImpl                               â”‚    â”‚
â”‚  â”‚  - ä¸šåŠ¡é€»è¾‘å¤„ç†                                â”‚    â”‚
â”‚  â”‚  - äº‹åŠ¡ç®¡ç†                                    â”‚    â”‚
â”‚  â”‚  - è°ƒç”¨ DAO                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ è°ƒç”¨
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              dw-dao (æ•°æ®è®¿é—®å±‚)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  AbstractDAO<User>                            â”‚    â”‚
â”‚  â”‚  UserDAO                                      â”‚    â”‚
â”‚  â”‚  - æ•°æ®åº“ CRUD æ“ä½œ                           â”‚    â”‚
â”‚  â”‚  - SQL/HQL æŸ¥è¯¢                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ æ“ä½œ
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Database (MySQL)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–æ³¨å…¥æµç¨‹

```
åº”ç”¨å¯åŠ¨ (dw-bootstrap)
    â”‚
    â”œâ”€â†’ Hk2DaoBinder
    â”‚   â””â”€â†’ æ‰«æ com.gutou.dao åŒ…
    â”‚       â””â”€â†’ è‡ªåŠ¨ç»‘å®šæ‰€æœ‰ AbstractDAO å­ç±»
    â”‚
    â”œâ”€â†’ Hk2ServiceBinder
    â”‚   â””â”€â†’ æ‰«æ com.gutou.service åŒ…
    â”‚       â””â”€â†’ è‡ªåŠ¨ç»‘å®šæ‰€æœ‰ @Service ç±»åˆ° @Contract æ¥å£
    â”‚
    â””â”€â†’ JerseyResourceRegistrar
        â””â”€â†’ æ‰«æ com.gutou.resource åŒ…
            â””â”€â†’ è‡ªåŠ¨æ³¨å†Œæ‰€æœ‰ @Path æ ‡æ³¨çš„ç±»
```

## ğŸ”— ä¾èµ–å…³ç³»

### æ¨¡å—ä¾èµ–é“¾

```
dw-bootstrap
  â”œâ”€â†’ dw-resource
  â”‚     â”œâ”€â†’ dw-service
  â”‚     â”‚     â”œâ”€â†’ dw-dao
  â”‚     â”‚     â”‚     â””â”€â†’ dw-model
  â”‚     â”‚     â””â”€â†’ dw-model
  â”‚     â””â”€â†’ dw-model
  â”œâ”€â†’ dw-service
  â”œâ”€â†’ dw-dao
  â”œâ”€â†’ dw-model
  â””â”€â†’ dw-common

ä¾èµ–è§„åˆ™:
- Resource å±‚ â†’ Service å±‚ + Model å±‚
- Service å±‚ â†’ DAO å±‚ + Model å±‚
- DAO å±‚ â†’ Model å±‚
- Bootstrap å±‚ â†’ æ‰€æœ‰æ¨¡å—
```

### ç¦æ­¢çš„ä¾èµ–æ–¹å‘

- âŒ Resource å±‚ä¸èƒ½ç›´æ¥ä¾èµ– DAO å±‚
- âŒ Service å±‚ä¸èƒ½ä¾èµ– Resource å±‚
- âŒ DAO å±‚ä¸èƒ½ä¾èµ– Service æˆ– Resource å±‚
- âŒ Model å±‚ä¸ä¾èµ–ä»»ä½•å…¶ä»–æ¨¡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- JDK 21+
- Maven 3.6+
- MySQL 8.0+
- æ•°æ®åº“ `dw_test` å·²åˆ›å»º

### 1. é…ç½®æ•°æ®åº“

ç¼–è¾‘ `dw-bootstrap/src/main/resources/config.yml`ï¼š

```yaml
database:
  driverClass: com.mysql.cj.jdbc.Driver
  url: jdbc:mysql://localhost:3306/dw_test?useSSL=false&serverTimezone=Asia/Shanghai
  user: root
  password: your_password
```

### 2. ç¼–è¯‘é¡¹ç›®

```bash
mvn clean package
```

### 3. è¿è¡Œåº”ç”¨

**Windows:**
```bash
.\run.bat
```

**Linux/Mac:**
```bash
./run.sh
```

æˆ–è€…ç›´æ¥è¿è¡Œ JAR:
```bash
java -jar dw-bootstrap/target/dw-bootstrap-1.0-SNAPSHOT.jar server dw-bootstrap/src/main/resources/config.yml
```

### 4. éªŒè¯è¿è¡Œ

è®¿é—®: http://localhost:8080

## ğŸ“¡ API ç«¯ç‚¹

### ç”¨æˆ·ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/users` | è·å–æ‰€æœ‰ç”¨æˆ· |
| GET | `/users/{id}` | æ ¹æ® ID è·å–ç”¨æˆ· |
| GET | `/users/email/{email}` | æ ¹æ®é‚®ç®±è·å–ç”¨æˆ· |
| POST | `/users` | åˆ›å»ºç”¨æˆ· |
| PUT | `/users/{id}` | æ›´æ–°ç”¨æˆ· |
| DELETE | `/users/{id}` | åˆ é™¤ç”¨æˆ· |
| GET | `/users/task` | ä»»åŠ¡æµ‹è¯•æ¥å£ |

### å®¹å™¨ä¿¡æ¯

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/container` | æŸ¥çœ‹æ‰€æœ‰æ³¨å†Œçš„æœåŠ¡ |
| GET | `/container/summary` | å®¹å™¨ç»Ÿè®¡ä¿¡æ¯ |
| GET | `/container/type/{typeName}` | æŒ‰ç±»å‹æŸ¥è¯¢æœåŠ¡ |

### ç®¡ç†ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/admin` | ç®¡ç†ç•Œé¢ |
| GET | `/admin/tasks` | ä»»åŠ¡åˆ—è¡¨ |

## ğŸ”§ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„ä¸šåŠ¡åŠŸèƒ½

1. **æ·»åŠ å®ä½“ç±»** (dw-model)
   ```java
   // dw-model/src/main/java/com/gutou/model/entity/YourEntity.java
   @Entity
   public class YourEntity { ... }
   ```

2. **æ·»åŠ  DAO** (dw-dao)
   ```java
   // dw-dao/src/main/java/com/gutou/dao/YourDAO.java
   public class YourDAO extends AbstractDAO<YourEntity> { ... }
   ```

3. **æ·»åŠ  Service** (dw-service)
   ```java
   // æ¥å£
   @Contract
   public interface YourServiceApi { ... }
   
   // å®ç°
   @Service
   public class YourServiceImpl implements YourServiceApi { ... }
   ```

4. **æ·»åŠ  Resource** (dw-resource)
   ```java
   // dw-resource/src/main/java/com/gutou/resource/YourResource.java
   @Path("/your-path")
   public class YourResource {
       @Inject
       private YourServiceApi yourService;
       ...
   }
   ```

### è‡ªåŠ¨æ‰«ææœºåˆ¶

- **DAO**: è‡ªåŠ¨æ‰«æç»§æ‰¿ `AbstractDAO` çš„ç±»
- **Service**: è‡ªåŠ¨æ‰«æå¸¦ `@Service` æ³¨è§£çš„ç±»
- **Resource**: è‡ªåŠ¨æ‰«æå¸¦ `@Path` æ³¨è§£çš„ç±»

æ‰€æœ‰æ‰«æéƒ½åœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨å®Œæˆï¼Œæ— éœ€æ‰‹åŠ¨æ³¨å†Œã€‚

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

ä¸»è¦é…ç½®æ–‡ä»¶ä½äº: `dw-bootstrap/src/main/resources/config.yml`

åŒ…å«é…ç½®é¡¹ï¼š
- æœåŠ¡å™¨é…ç½®ï¼ˆç«¯å£ã€è·¯å¾„ç­‰ï¼‰
- æ•°æ®åº“é…ç½®
- æ—¥å¿—é…ç½®
- Hibernate é…ç½®

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•:
```bash
mvn test
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ç”¨äºå­¦ä¹ å’Œæµ‹è¯•ç›®çš„ã€‚

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

## ğŸ”„ å¤šå®ç°æ³¨å…¥ä¸æ‰§è¡Œé¡ºåºï¼ˆ@Rankï¼‰

åœ¨ HK2 ä¸­ï¼Œä¸€ä¸ª `@Contract` æ¥å£å¯èƒ½ä¼šæœ‰å¤šä¸ª `@Service` å®ç°ï¼ˆä¾‹å¦‚å¯åŠ¨ä»»åŠ¡ã€ç­–ç•¥å®ç°ã€æ’ä»¶æ‰©å±•ç‚¹ç­‰ï¼‰ã€‚æ­¤æ—¶å¸¸è§éœ€æ±‚æ˜¯ï¼š

1. **æ³¨å…¥å¹¶è·å–è¯¥ Contract çš„æ‰€æœ‰å®ç°**
2. **æŒ‰ç…§å›ºå®šé¡ºåºä¾æ¬¡æ‰§è¡Œ**

### 1) å®šä¹‰ Contract ä¸å¤šä¸ªå®ç°

```java
import org.jvnet.hk2.annotations.Contract;

@Contract
public interface JobService {
    void execute();
}
```

```java
import lombok.extern.slf4j.Slf4j;
import org.glassfish.hk2.api.Rank;
import org.jvnet.hk2.annotations.Service;

@Slf4j
@Service
@Rank(10) // æ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆé¡¹ç›®çº¦å®šï¼‰
public class StartUpJob2 implements JobService {
    @Override
    public void execute() {
        log.info("StartUpJob2 execute");
    }
}
```

```java
import lombok.extern.slf4j.Slf4j;
import org.glassfish.hk2.api.Rank;
import org.jvnet.hk2.annotations.Service;

@Slf4j
@Service
@Rank(20) // æ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆé¡¹ç›®çº¦å®šï¼‰
public class StartUpJob1 implements JobService {
    @Override
    public void execute() {
        log.info("StartUpJob1 execute");
    }
}
```

> **çº¦å®šè¯´æ˜**ï¼šæœ¬é¡¹ç›®é‡‡ç”¨â€œ`@Rank` æ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜â€çš„è§„åˆ™ï¼ˆä¸ HK2 é»˜è®¤çš„â€œæ•°å€¼è¶Šå¤§è¶Šä¼˜å…ˆâ€ç›¸åï¼‰ï¼Œå› æ­¤åœ¨è‡ªåŠ¨ç»‘å®šé˜¶æ®µä¼šåšä¸€æ¬¡ rank æ˜ å°„ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚

---

### 2) è‡ªåŠ¨ç»‘å®šæ—¶å°† @Rank å†™å…¥ HK2 Descriptorï¼ˆå¹¶åè½¬ä¼˜å…ˆçº§ï¼‰

ç”±äºæœ¬é¡¹ç›®ä½¿ç”¨ `Hk2ServiceBinder` é€šè¿‡åå°„æ‰«æå¹¶æ‰‹å·¥ `bind()`ï¼Œéœ€è¦åœ¨ç»‘å®šæ—¶æ˜¾å¼è®¾ç½® `.ranked(...)`ï¼Œå¦åˆ™ `@Rank` åªå­˜åœ¨äºç±»æ³¨è§£ä¸­ï¼Œ**ä¸ä¼šå½±å“ HK2 çš„å€™é€‰é€‰æ‹©ä¸è¿­ä»£é¡ºåº**ã€‚

ä¸ºå®ç°â€œrank è¶Šå°è¶Šä¼˜å…ˆâ€ï¼Œç»‘å®šæ—¶éœ€å°†æ³¨è§£å€¼æ˜ å°„ä¸º HK2 çš„ rankï¼ˆHK2 é»˜è®¤ï¼šrank è¶Šå¤§è¶Šä¼˜å…ˆï¼‰ï¼š

```java
private int getRank(Class<?> serviceClass) {
    Rank r = serviceClass.getAnnotation(Rank.class);

    // æœªæ ‡æ³¨ Rank çš„å®ç°é»˜è®¤æ’æœ€åï¼ˆé¡¹ç›®çº¦å®šï¼‰
    int original = (r == null) ? 1_000_000_000 : r.value();

    // æ˜ å°„åˆ° HK2ï¼šoriginal è¶Šå° => hk2Rank è¶Šå¤§ï¼ˆè¶Šä¼˜å…ˆï¼‰
    return Integer.MAX_VALUE - original;
}
```

---

### 3) æ³¨å…¥å…¨éƒ¨å®ç°å¹¶æŒ‰é¡ºåºæ‰§è¡Œ

æ¨èä½¿ç”¨ `IterableProvider<T>` æ³¨å…¥å…¨éƒ¨å®ç°ï¼š

```java
import jakarta.inject.Inject;
import jakarta.inject.Singleton;
import org.glassfish.hk2.api.IterableProvider;

@Singleton
public class StartUpJobManager {

    private final IterableProvider<JobService> jobs;

    @Inject
    public StartUpJobManager(IterableProvider<JobService> jobs) {
        this.jobs = jobs;
    }

    public void start() {
        // æ³¨æ„ï¼šåœ¨ ranked(...) ç”Ÿæ•ˆåï¼ŒIterableProvider çš„è¿­ä»£é¡ºåºå°±æ˜¯æŒ‰ rank æ’å¥½çš„
        for (JobService job : jobs) {
            job.execute();
        }
    }
}
```

æ‰§è¡Œé¡ºåºå°†ä¸ºï¼š

* `@Rank(10)` çš„å®ç°å…ˆæ‰§è¡Œ
* `@Rank(20)` çš„å®ç°åæ‰§è¡Œ

---

### 4) ä»…æ³¨å…¥å•ä¸ªå®ç°çš„é€‰æ‹©è§„åˆ™

å½“ä½¿ç”¨ï¼š

```java
@Inject
private JobService jobService;
```

ä¸”å­˜åœ¨å¤šä¸ªå®ç°æ—¶ï¼ŒHK2 ä¼šé€‰æ‹©â€œä¼˜å…ˆçº§æœ€é«˜â€çš„å®ç°ä½œä¸ºé»˜è®¤æ³¨å…¥ç›®æ ‡ã€‚
åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œç”±äºåœ¨ Binder é˜¶æ®µåšäº† rank åè½¬æ˜ å°„ï¼Œå› æ­¤é»˜è®¤ä¼šæ³¨å…¥ **`@Rank` æ•°å€¼æœ€å°** çš„é‚£ä¸ªå®ç°ã€‚

---

### 5) æœ€ä½³å®è·µå»ºè®®

* å¯¹â€œæ‰©å±•ç‚¹/æ’ä»¶ç‚¹/ä»»åŠ¡é“¾â€ç±»æ¥å£ï¼Œå»ºè®®ç»Ÿä¸€ä½¿ç”¨ `@Rank` æ§åˆ¶æ‰§è¡Œé¡ºåºã€‚
* æœªæ ‡æ³¨ `@Rank` çš„å®ç°å»ºè®®é»˜è®¤æ’åœ¨æœ€åï¼Œé¿å…æ„å¤–æŠ¢å æ‰§è¡Œé¡ºåºã€‚
* è‹¥å­˜åœ¨å¼ºä¾èµ–é¡ºåºçš„ä»»åŠ¡ï¼ˆä¾‹å¦‚å¿…é¡»å…ˆåˆå§‹åŒ– A æ‰èƒ½æ‰§è¡Œ Bï¼‰ï¼Œè¯·ç”¨ `@Rank` æ˜ç¡®è¡¨è¾¾ï¼Œä¸è¦ä¾èµ–æ‰«æé¡ºåºæˆ–ç±»åé¡ºåºã€‚


**æœ€åæ›´æ–°**: 2025-01-03

